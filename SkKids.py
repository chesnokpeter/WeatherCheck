from pyowm import OWM
from pyowm.utils import config
from pyowm.utils import timestamps
from pyowm.utils.config import get_default_config
import telebot
from telebot import types
import random
import requests

headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36'}
config_dict = get_default_config()
config_dict["language"] = "RU"
owm = OWM('a99967bc9ee70d5b4bd387902982f400')
mgr = owm.weather_manager()
bot = telebot.TeleBot("5707305838:AAE2OHw5EmcY_kHENwRWt8BVOzlivWtq4co")

fact = [
  "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –ó–µ–º–ª–∏ –∏–º–µ–µ—Ç —Ç–æ–ª—â–∏–Ω—É 480 –∫–º –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–º–µ—Å–∏ –æ–∫–æ–ª–æ 16 –≥–∞–∑–æ–≤",
  "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 5 —Å–ª–æ—ë–≤: –¢—Ä–æ–ø–æ—Å—Ñ–µ—Ä–∞, –°—Ç—Ä–∞—Ç–æ—Å—Ñ–µ—Ä–∞, –ú–µ–∑–æ—Å—Ñ–µ—Ä–∞, –¢–µ—Ä–º–æ—Å—Ñ–µ—Ä–∞ –∏ –≠–∫–∑–æ—Å—Ñ–µ—Ä–∞",
  "–ü–æ –º–µ—Ä–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å–µ —Ç–æ–Ω—å—à–µ –∏ —Ç–æ–Ω—å—à–µ. –î–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞ –≤ —ç–∫–∑–æ—Å—Ñ–µ—Ä–µ (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —Å–ª–æ–π) —á—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ –Ω–∏–∑–∫–æ–µ –∏–∑-–∑–∞ –µ–≥–æ –±–æ–ª—å—à–æ–π –≤—ã—Å–æ—Ç—ã –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –º–æ–ª–µ–∫—É–ª–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —É –Ω–µ–≥–æ –µ—Å—Ç—å",
  "–ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–ª–∏–º–∞—Ç –Ω–∞–≥—Ä–µ–≤–∞–ª—Å—è –∏ –æ—Ö–ª–∞–∂–¥–∞–ª—Å—è –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏. –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –º—ã –Ω–∞–±–ª—é–¥–∞–µ–º –Ω–µ–æ–±—ã—á–Ω–æ–µ –±—ã—Å—Ç—Ä–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ –ø–∞—Ä–Ω–∏–∫–æ–≤—ã—Ö –≥–∞–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è –∏–∑-–∑–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∏ –æ–Ω–∏ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ç–µ–ø–ª–æ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ",
  "–û–¥–Ω–æ–π –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –≤–µ—â–µ–π –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ —è–≤–ª—è–µ—Ç—Å—è –æ–∑–æ–Ω–æ–≤—ã–π —Å–ª–æ–π. –≠—Ç–æ 19-32 –∫–º –Ω–∞–¥ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å—é –ó–µ–º–ª–∏. –≠—Ç–æ –æ—Å—Ç—Ä—ã–π –∑–∞–ø–∞—Ö –≥–æ–ª—É–±–æ–≥–æ –≥–∞–∑–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≥–ª–æ—â–∞–µ—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —É–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ –∏–∑–ª—É—á–µ–Ω–∏—è —Å–æ–ª–Ω—Ü–∞",
  "–ú–µ—Ç–µ–æ—Ä—ã —Å–≥–æ—Ä–∞—é—Ç –≤ —Ö–æ–ª–æ–¥–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ –ó–µ–º–ª–∏ ‚Äì —Å–ª–æ–π –º–µ–∑–æ—Å—Ñ–µ—Ä—ã. –ö–æ–≥–¥–∞ –º–µ—Ç–µ–æ—Ä–∏—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—Ö–æ–¥–∏—Ç—å –≤ —ç—Ç–æ—Ç —Å–ª–æ–π, –æ–Ω –±—ã—Å—Ç—Ä–æ –Ω–∞—Ç—ã–∫–∞–µ—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏—Ü—ã –º–µ–∑–æ—Å—Ñ–µ—Ä—ã –∏ —Ü–∞—Ä–∞–ø–∞–µ—Ç –∏—Ö. –ê –ø–æ—Å–∫–æ–ª—å–∫—É —Å–∫–æ—Ä–æ—Å—Ç—å –º–µ—Ç–µ–æ—Ä–∏—Ç–∞ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∞, –æ–Ω –±—ã—Å—Ç—Ä–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–ø–ª–∞ (–∏–∑-–∑–∞ –≤—ã—Å–æ–∫–æ–≥–æ —Ç—Ä–µ–Ω–∏—è –º–µ–∂–¥—É —á–∞—Å—Ç–∏—Ü–∞–º–∏ –º–µ–∑–æ—Å—Ñ–µ—Ä—ã –∏ –º–µ—Ç–µ–æ—Ä–æ–º). –û–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–≤–µ—Ç–∏—Ç—å—Å—è",
  "–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –≤–æ–∑–¥—É—Ö–∞ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ 1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–º–µ—à–∏–≤–∞–Ω–∏—é —Å–≤–µ—Ç–æ–≤—ã—Ö –ª—É—á–µ–π –ø–æ –¥–ª–∏–Ω–Ω—ã–º –æ–ø—Ç–∏—á–µ—Å–∫–∏–º –ø—É—Ç—è–º. –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –≤–æ–∑–¥—É—Ö–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã. –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–∞—é—Ç —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã. –ú–∏—Ä–∞–∂ - –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä"
]

words_ = [
  "–•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è:)\n–£ —Ç–µ–±—è –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è",
  "–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –¥–Ω—è!",
  "–ù–µ –∑–∞–±—É–¥—å –≤–∑—è—Ç—å —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ ^_^", 
  "–•–æ—Ä–æ—à–µ–≥–æ –≤—Ä–µ–º—è–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è ^_^",
  "–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ–≥–æ –¥–Ω—è! :)"
]

print("Excellent!")

@bot.message_handler(commands=['start'])
def start_message(message):
	markup = types.InlineKeyboardMarkup()
	button1 = types.InlineKeyboardButton("–ò—Å–∫–∞—Ç—å", switch_inline_query_current_chat="")
	button2 = types.InlineKeyboardButton("–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç!", callback_data='fact')
	markup.add(button1, button2)
	bot.send_message(message.chat.id, text="–ü—Ä–∏–≤–µ—Ç, –¥—Ä—É–≥!\n–ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É, –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ\n–ò –≤–≤–æ–¥–∏ –ª—é–±–æ–π –≥–æ—Ä–æ–¥ –†–æ—Å—Å–∏–∏\n–ë–æ—Ç —Å–∞–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Ç–µ–±–µ –Ω—É–∂–Ω—ã–π –≥–æ—Ä–æ–¥", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: True)
def callback_inline(call):
	if call.data == 'fact':
		nummes1 = random.randint(0, 6)
		bot.send_message(call.message.chat.id, fact[nummes1])

@bot.inline_handler(lambda query: len(query.query) > 2)
def query_text(inline_query):
        ntt = inline_query.query
        response = requests.get(f'http://k92900u9.beget.tech/api.php?q={ntt}&limit=5', headers=headers)
        cities = response.json()
        label = []

        for citie in cities:
            print(citie)
            label.append(types.InlineQueryResultArticle(citie["id"], citie["name"], types.InputTextMessageContent(citie["name"])))

        bot.answer_inline_query(inline_query.id, label)

@bot.message_handler(commands=['check'])
def start_message(message):
	bot.send_message(message.chat.id, "–Ø —Ä–∞–±–æ—Ç–∞—é!")

@bot.message_handler(commands=['about'])
def start_message(message):
	bot.send_message(message.chat.id, "–≠—Ç–æ—Ç –±–æ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ Sk Kids Challenge\n–ù–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º —Ä–∞–±–æ—Ç–∞–ª:\n\n<chesnok/> üßëüèª‚Äçüíª ‚Äî –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n(@chesnokpeter)\n–ê–Ω—Ç–æ–Ω üëæ ‚Äî –ù–∞—Å—Ç–∞–≤–Ω–∏–∫\n(https://vk.com/a_d_elec)")

@bot.message_handler(content_types=['text'])
def send_echo(message):		
	try:
		observation = mgr.weather_at_place(message.text)
		w = observation.weather
		temp = w.temperature('celsius')["temp"]
		wind = w.wind()['speed']

		if temp < 5:
			tips = "üß• –ù–∞ —É–ª–∏—Ü–µ —Ö–æ–ª–æ–¥–Ω–æ, –ë–æ—Ç —Å–æ–≤–µ—Ç—É–µ—Ç –æ–¥–µ—Ç—å –∫—É—Ä—Ç–∫—É "

		elif temp > 25:
			tips = "üëï –ù–∞ —É–ª–∏—Ü–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∂–∞—Ä–∫–æ, –ë–æ—Ç —Å–æ–≤–µ—Ç—É–µ—Ç –æ–¥–µ—Ç—å –º–∞–π–∫—É"

		elif temp < -15:
			tips = "‚ùÑÔ∏è –ù–∞ —É–ª–∏—Ü–µ –æ—á–µ–Ω—å —Ö–æ–ª–æ–¥–Ω–æ, "

		else:
			tips = "üå§ –ù–∞ —É–ª–∏—Ü–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ"

		nummes2 = random.randint(0, 4)
		words = words_[nummes2]

		answer = f"‚≠êÔ∏è –í—ã–±—Ä–∞–Ω –≥–æ—Ä–æ–¥: {message.text}\n\n‚òÅÔ∏è –°–µ–π—á–∞—Å {w.detailed_status}\nüí° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {round(temp, 1)}¬∞ –°\nüå¨ –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ä—Ç—Ä–∞: {round(wind, 0)} –º/—Å\n\n{tips}\n\n{words}"

	except:
		answer = "–û—à–∏–±–∫–∞!"

	finally:
		bot.send_message(message.chat.id, answer)

bot.polling(none_stop=True, interval=0)
